/*!
 * PrimeBible Verse Preview - Premium Edition
 * Version 2.5.2 - Fixed chapter URLs to use proper format (/translation/book/chapter); counts-free expansion; unit tests
 * Attach to any page. Configure with window.PrimeBibleConfig before this script.
 */
!function(){"use strict";if(window.PrimeBible&&"function"==typeof window.PrimeBible.destroy)try{window.PrimeBible.destroy()}catch{}const e=Object.assign({},{apiUrl:"https://primebible.com/api/verse-preview",translation:"KJV",theme:"system",position:"auto",maxWidth:420,mobileMaxWidth:340,showReference:!0,showFooter:!0,customStyles:null,hoverDelayMs:200,longPressMs:400,hideDelayMs:150,excludeSelectors:["script","style","noscript","iframe","textarea","code","pre",".pbv-no-scan"],onError:null,enableAnimations:!0,mobileOptimized:!0,prefetch:!0,maxCacheSize:100,cacheExpiry:36e5,analytics:!1,timeoutMs:8e3,retries:2,maxConcurrentFetches:4,maxMatchesPerNode:50,maxNodeTextLength:12e3,styleNonce:null,lazyScan:!0,chapterVerseCounts:null,debug:!1},window.PrimeBibleConfig||{});"function"!=typeof window.requestIdleCallback&&(window.requestIdleCallback=function(e,t){const n=Date.now();return setTimeout(function(){e({didTimeout:!(!t||!t.timeout),timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},t&&t.timeout?t.timeout:1)}),"function"!=typeof window.cancelIdleCallback&&(window.cancelIdleCallback=function(e){clearTimeout(e)});const t=(()=>{if("undefined"!=typeof performance&&performance&&"function"==typeof performance.now){const e=Date.now()-performance.now();return()=>e+performance.now()}return()=>Date.now()})(),n=(()=>{let e=null;const invalidate=()=>{e=null};return window.addEventListener("resize",invalidate,{passive:!0}),window.addEventListener("orientationchange",invalidate),()=>(null==e&&(e=(()=>{const mm=e=>window.matchMedia&&window.matchMedia(e).matches,e=mm("(pointer: coarse)"),t=mm("(hover: none)"),n=mm("(max-width: 768px)"),o=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return e&&t||o||n})()),e)})(),hasTouch=()=>"ontouchstart"in window||navigator.maxTouchPoints>0;const o=["Genesis","Gen","Ge","Gn","Exodus","Ex","Exo","Exod","Leviticus","Lev","Le","Lv","Numbers","Num","Nu","Nm","Nb","Deuteronomy","Deut","Dt","De","Joshua","Josh","Jos","Jsh","Judges","Judg","Jdg","Jg","Jdgs","Ruth","Rth","Ru","1 Samuel","1st Samuel","1 Sam","1st Sam","1 Sa","1st Sa","1 S","1st S","I Samuel","I Sam","I Sa","I S","2 Samuel","2nd Samuel","2 Sam","2nd Sam","2 Sa","2nd Sa","2 S","2nd S","II Samuel","II Sam","II Sa","II S","1 Kings","1st Kings","1 Kgs","1st Kgs","1 Ki","1st Ki","I Kings","I Kgs","I Ki","2 Kings","2nd Kings","2 Kgs","2nd Kgs","2 Ki","2nd Ki","II Kings","II Kgs","II Ki","1 Chronicles","1st Chronicles","1 Chron","1st Chron","1 Ch","1st Ch","I Chronicles","I Chron","I Ch","2 Chronicles","2nd Chronicles","2 Chron","2nd Chron","2 Ch","2nd Ch","II Chronicles","II Chron","II Ch","Ezra","Ezr","Ez","Nehemiah","Neh","Ne","Esther","Est","Es","Job","Jb","Psalms","Psalm","Ps","Psa","Psm","Pss","Proverbs","Prov","Pro","Pr","Prv","Ecclesiastes","Eccles","Ecc","Ec","Qoh","Song of Solomon","Song of Songs","Song","SOS","So","Canticles","Cant","Canticle of Canticles","Isaiah","Isa","Jeremiah","Jer","Je","Jr","Lamentations","Lam","La","Ezekiel","Ezek","Eze","Ezk","Daniel","Dan","Da","Dn","Hosea","Hos","Ho","Joel","Joe","Jl","Amos","Am","Obadiah","Obad","Ob","Jonah","Jon","Jnh","Micah","Mic","Mc","Nahum","Nah","Na","Habakkuk","Hab","Hb","Zephaniah","Zeph","Zep","Zp","Haggai","Hag","Hg","Zechariah","Zech","Zec","Zc","Malachi","Mal","Ml","Matthew","Matt","Mt","Mat","Mark","Mrk","Mk","Mr","Mar","Luke","Luk","Lk","John","Joh","Jn","Jhn","Acts","Act","Ac","Romans","Rom","Ro","Rm","1 Corinthians","1st Corinthians","1 Corin","1st Corin","1 Cor","1st Cor","1 Co","1st Co","I Corinthians","I Cor","I Co","2 Corinthians","2nd Corinthians","2 Corin","2nd Corin","2 Cor","2nd Cor","2 Co","2nd Co","II Corinthians","II Cor","II Co","Galatians","Gal","Ga","Gl","Ephesians","Eph","Philippians","Phil","Php","Colossians","Col","Co","1 Thessalonians","1st Thessalonians","1 Thess","1st Thess","1 Thes","1st Thes","1 Th","1st Th","I Thessalonians","I Thess","I Thes","I Th","2 Thessalonians","2nd Thessalonians","2 Thess","2nd Thess","2 Thes","2nd Thes","2 Th","2nd Th","II Thessalonians","II Thess","II Thes","II Th","1 Timothy","1st Timothy","1 Tim","1st Tim","1 Ti","1st Ti","I Timothy","I Tim","I Ti","2 Timothy","2nd Timothy","2 Tim","2nd Tim","2 Ti","2nd Ti","II Timothy","II Tim","II Ti","Titus","Tit","Ti","Philemon","Philem","Phm","Hebrews","Heb","James","Jam","Jas","1 Peter","1st Peter","1 Pet","1st Pet","1 Pe","1st Pe","1 Pt","1st Pt","I Peter","I Pet","I Pe","I Pt","2 Peter","2nd Peter","2 Pet","2nd Pet","2 Pe","2nd Pe","2 Pt","2nd Pt","II Peter","II Pet","II Pe","II Pt","1 John","1st John","1 Jn","1st Jn","1 Jo","1st Jo","1 Jhn","1st Jhn","I John","I Jn","I Jo","I Jhn","2 John","2nd John","2 Jn","2nd Jn","2 Jo","2nd Jo","2 Jhn","2nd Jhn","II John","II Jn","II Jo","II Jhn","3 John","3rd John","3 Jn","3rd Jn","3 Jo","3rd Jo","3 Jhn","3rd Jhn","III John","III Jn","III Jo","III Jhn","Jude","Jud","Ju","Jd","Revelation","Rev","Re","Reve"].slice().sort((e,t)=>t.length-e.length).map(e=>function escapeForRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}(e).replace(/[.\s]/g,"[\\s.]*")).join("|"),r="[\\-\\u2010\\u2011\\u2012\\u2013\\u2014\\u2212]",s="(?:\\d+:\\d+|\\d+(?!:))",a=new RegExp("\\b("+o+")\\.?\\s+\\d+(?::\\d+(?:"+r+s+")?|"+r+"\\d+(?!:))?(?:\\s*[;,]\\s*\\d+(?!\\s+(?:"+o+"))(?::\\d+(?:"+r+s+")?|"+r+"\\d+(?!:))?)*\\b","gi"),i=new RegExp(a.source,"i"),l={light:{background:"linear-gradient(135deg, #ffffff 0%, #fafafa 100%)",solidBackground:"#ffffff",border:"rgba(0, 0, 0, 0.08)",text:"#1a1a1a",shadow:"0 10px 40px rgba(0, 0, 0, 0.12), 0 2px 10px rgba(0, 0, 0, 0.06)",mobileShadow:"0 8px 30px rgba(0, 0, 0, 0.15)",reference:"#374151",verseNumber:"#6b7280",footerBg:"#f8fafc",footerText:"#64748b",footerLink:"#2563eb",footerBorder:"rgba(0, 0, 0, 0.06)",highlightBg:"rgba(37, 99, 235, 0.08)",scrollbar:"rgba(0, 0, 0, 0.2)",scrollbarHover:"rgba(0, 0, 0, 0.3)"},dark:{background:"linear-gradient(135deg, #1f2937 0%, #0b1220 100%)",solidBackground:"#0f172a",border:"rgba(255, 255, 255, 0.1)",text:"#e5e7eb",shadow:"0 10px 40px rgba(0, 0, 0, 0.5), 0 2px 10px rgba(0, 0, 0, 0.3)",mobileShadow:"0 8px 30px rgba(0, 0, 0, 0.6)",reference:"#93a2b8",verseNumber:"#94a3b8",footerBg:"#0b1220",footerText:"#94a3b8",footerLink:"#60a5fa",footerBorder:"rgba(255, 255, 255, 0.08)",highlightBg:"rgba(96, 165, 250, 0.15)",scrollbar:"rgba(255, 255, 255, 0.2)",scrollbarHover:"rgba(255, 255, 255, 0.3)"}};function resolveThemeName(){if("system"===e.theme)try{return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}catch{return"light"}return l[e.theme]?e.theme:"light"}let c=null,d=null,p=null,h=null,u=null,m=null,f=null,b=null,g=!1,y=!1,w=null,x=null;window.__PBV_GLOBAL_BOUND__||(window.__PBV_GLOBAL_BOUND__=!1);const docClickHandler=function(e){const t=e&&e.target&&1===e.target.nodeType?e.target:e&&e.target?e.target.parentElement:null;if(!c||"block"!==c.style.display)return;const n=t&&t.closest&&t.closest("#pbv-tooltip"),o=t&&t.closest&&t.closest(".pbv-ref");n||o||hideTooltip(!0)},docKeydownHandler=function(e){"Escape"===e.key&&c&&"block"===c.style.display&&hideTooltip(!0)};window.__PBV_GLOBAL_BOUND__||(document.addEventListener("click",docClickHandler),document.addEventListener("keydown",docKeydownHandler),window.__PBV_GLOBAL_BOUND__=!0);const v=new WeakMap,T=new WeakMap,C=new Set;function abortAllActiveRequests(){C.forEach(e=>{try{e.abort()}catch{}}),C.clear(),document.querySelectorAll(".pbv-ref").forEach(e=>{T.delete(e),v.delete(e)})}const E=new Map,I=new Map,N=new Map,k=new Set;function normalizeRef(e){return function normalizeSpacing(e){return String(e||"").replace(/\s*-\s*/g,"-").replace(/\s*,\s*/g,",").replace(/\s*;\s*/g,";").replace(/\s*:\s*/g,":").replace(/\s+/g," ").trim()}(function normalizeDashes(e){return String(e||"").replace(/[\u2010\u2011\u2012\u2013\u2014\u2212]/g,"-")}(e))}function anySignal(e){const t=new AbortController,onAbort=()=>t.abort(),n=[];return e.filter(Boolean).forEach(e=>{e.aborted?t.abort():(e.addEventListener("abort",onAbort,{once:!0}),n.push(()=>e.removeEventListener("abort",onAbort)))}),{signal:t.signal,cleanup:()=>n.forEach(e=>e())}}const S={attempts:new Map,check(e){const n=t(),o=(this.attempts.get(e)||[]).filter(e=>n-e<6e4);return!(o.length>=10)&&(o.push(n),this.attempts.set(e,o),!0)}};async function fetchSingleRef(t,n,o){const r=n+"|"+t;if(!S.check(r))throw new Error("Rate limit exceeded");const s=new URLSearchParams({ref:t,translation:n,format:"html"}),a=e.apiUrl+"?"+s.toString(),i=await async function fetchJSON(t,n=e.retries,o=e.timeoutMs,r){for(let e=0;e<=n;e++){let s=null,a=null,i=null;try{s=new AbortController,a=setTimeout(()=>s.abort(),o),i=r?anySignal([s.signal,r]):{signal:s.signal,cleanup:()=>{}};const l=await fetch(t,{mode:"cors",headers:{Accept:"application/json","X-Requested-With":"PrimeBible-Embed"},signal:i.signal});if(!l.ok){const t=new Error("HTTP "+l.status);if(t.status=l.status,e===n)throw t;await new Promise(t=>setTimeout(t,1e3*(e+1)));continue}return l.json()}catch(t){if(e===n)throw t}finally{i&&i.cleanup(),a&&clearTimeout(a)}}}(a,e.retries,e.timeoutMs,o);return"object"==typeof i?function validateApiResponse(e){if("object"!=typeof e||null===e||"string"!=typeof e.text)throw new Error("Invalid API response structure");if(e.text.length>5e4)throw new Error("Response too large");if(/<script|javascript:|on\w+=/i.test(e.text))throw new Error("Suspicious content detected");return e}(i).text:"string"==typeof i?i:"Verse not found."}function splitRefIntoPieces(e){const t=new RegExp("^\\s*("+o+")\\.?\\s+(\\d+)(?::(.*))?\\s*$","i"),n=e.match(t);if(!n)return[e];const r=n[1].replace(/\./g,""),s=n[2],a=n[3];if(!a)return[r+" "+s];const i=[],l=a.split(";");let c=s;for(let e of l){const t=e.trim();if(t)if(/^\d+\s*:/.test(t)){const e=t.indexOf(":"),n=t.slice(0,e).trim(),o=t.slice(e+1).trim(),s=parseInt(n,10);if(isNaN(s)||(c=String(s)),!o){i.push(r+" "+c);continue}i.push(r+" "+c+":"+o)}else i.push(r+" "+c+":"+t)}const d=new Set,p=[];for(const e of i){const t=e.toLowerCase();d.has(t)||(d.add(t),p.push(e))}return p.length?p:[e]}function expandCrossChapterWithCounts(e,t,n,o,r,s){const a=parseInt(t,10),i=parseInt(o,10),l=parseInt(n,10),c=parseInt(r,10);if(isNaN(a)||isNaN(i)||isNaN(l)||isNaN(c)||i<a)return[e+" "+t+":"+n+"-"+o+":"+r];const d=[];for(let p=a;p<=i;p++){const h=parseInt(s[String(p)],10);if(!h)return[e+" "+t+":"+n+"-"+o+":"+r];const u=p===a?l:1,m=p===i?c:h;d.push(e+" "+p+":"+u+"-"+m)}return d}function expandCrossChapterNoCounts(e,t,n,o,r){const s=parseInt(t,10),a=parseInt(o,10),i=parseInt(n,10),l=parseInt(r,10);if(isNaN(s)||isNaN(a)||isNaN(i)||isNaN(l)||a<s)return[e+" "+t+":"+n+"-"+o+":"+r];if(s===a)return[e+" "+s+":"+i+"-"+l];const c=[];c.push(e+" "+s+":"+i+"-999");for(let t=s+1;t<=a-1;t++)c.push(e+" "+t+":1-999");return c.push(e+" "+a+":1-"+l),c}function expandChapterRangeNoCounts(e,t,n){const o=parseInt(t,10),r=parseInt(n,10);if(isNaN(o)||isNaN(r)||r<o)return[e+" "+t+"-"+n];const s=[];for(let t=o;t<=r;t++)s.push(e+" "+t+":1-999");return s}function expandChapterRangeWithCounts(e,t,n,o){const r=parseInt(t,10),s=parseInt(n,10);if(isNaN(r)||isNaN(s)||s<r)return[e+" "+t+"-"+n];const a=[];for(let i=r;i<=s;i++){const r=parseInt(o[String(i)],10);if(!r)return[e+" "+t+"-"+n];a.push(e+" "+i+":1-"+r)}return a}function expandPiecesWithVerseCounts(t){const n=new RegExp("^\\s*("+o+")\\.?\\s+(\\d+):(\\d+)-(?:(\\d+):)?(\\d+)\\s*$","i"),r=new RegExp("^\\s*("+o+")\\.?\\s+(\\d+)\\s*-\\s*(\\d+)\\s*$","i"),s=[];for(const o of t){let t=o.match(n);if(t){const n=t[1].replace(/\./g,""),o=t[2],r=t[3],a=t[4]||t[2],i=t[5],l=e.chapterVerseCounts&&e.chapterVerseCounts[n];l?s.push(...expandCrossChapterWithCounts(n,o,r,a,i,l)):s.push(...expandCrossChapterNoCounts(n,o,r,a,i));continue}if(t=o.match(r),t){const n=t[1].replace(/\./g,""),o=t[2],r=t[3],a=e.chapterVerseCounts&&e.chapterVerseCounts[n];a?s.push(...expandChapterRangeWithCounts(n,o,r,a)):s.push(...expandChapterRangeNoCounts(n,o,r));continue}s.push(o.replace(/\./g,""))}return s}function compressRefForDisplay(e){const t=new RegExp("^\\s*("+o+")\\.?\\s+(\\d+)(?::(.*))?\\s*$","i"),n=e.match(t);if(!n)return e;const r=n[1].replace(/\./g,""),s=n[2],a=n[3];if(!a)return r+" "+s;let i=s;const l=a.split(";").map(e=>e.trim()).filter(Boolean),c=[],d=/^\s*(\d+)\s*-\s*(\d+)\s*:\s*(\d+)\s*$/;function compressItems(e){const t=[],n=[];for(const o of e){const e=o.trim();if(e)if(/^\d+\s*-\s*\d+$/.test(e)){const[t,o]=e.split("-").map(e=>parseInt(e.trim(),10));isNaN(t)||isNaN(o)||n.push([Math.min(t,o),Math.max(t,o)])}else if(/^\d+$/.test(e)){const n=parseInt(e,10);isNaN(n)||t.push(n)}else n.push([e,e])}t.sort((e,t)=>e-t);for(let e=0;e<t.length;){const o=t[e];let r=o;for(e++;e<t.length&&t[e]===r+1;)r=t[e],e++;r>o?n.push([o,r]):n.push([o,o])}return n.sort((e,t)=>("number"==typeof e[0]?e[0]:Number.MAX_SAFE_INTEGER)-("number"==typeof t[0]?t[0]:Number.MAX_SAFE_INTEGER)),n.map(([e,t])=>"number"==typeof e&&"number"==typeof t?e===t?String(e):String(e)+"-"+String(t):String(e)).join(", ")}for(const e of l){const t=e.match(d);if(t){const e=t[1],n=t[2],o=t[3];c.push(i+":"+e+"-"+n+":"+o),i=String(parseInt(n,10));continue}if(e.includes(":")){const t=e.indexOf(":"),n=e.slice(0,t).trim(),o=e.slice(t+1).trim();if(!/^\d+$/.test(n)){c.push(i+":"+e);continue}if(i=String(parseInt(n,10)),!o){c.push(i);continue}const r=o.split(",");c.push(i+":"+compressItems(r))}else{const t=e.split(",");c.push(i+":"+compressItems(t))}}return r+" "+c.join("; ")}function injectStyles(){const t=resolveThemeName(),n=l[t];let o=document.getElementById("pbv-styles");o||(o=document.createElement("style"),o.id="pbv-styles",e.styleNonce&&o.setAttribute("nonce",String(e.styleNonce)),document.head.appendChild(o)),o.textContent=`\n      .pbv-ref { position: relative; display: inline-block; transition: all 0.2s ease; }\n      .pbv-ref:hover { opacity: 0.9; }\n      .pbv-ref.pbv-active { background: ${n.highlightBg}; border-radius: 4px; padding: 0 2px; }\n      #pbv-tooltip { -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; animation: pbvFadeIn 0.2s ease-out; word-break: break-word; overflow-wrap: anywhere; white-space: normal; max-width: 100vw; }\n      #pbv-tooltip * { box-sizing: border-box; }\n      #pbv-tooltip::-webkit-scrollbar { width: 6px; height: 6px; }\n      #pbv-tooltip::-webkit-scrollbar-track { background: transparent; }\n      #pbv-tooltip::-webkit-scrollbar-thumb { background: ${n.scrollbar}; border-radius: 3px; }\n      #pbv-tooltip::-webkit-scrollbar-thumb:hover { background: ${n.scrollbarHover}; }\n      @keyframes pbvFadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }\n      .pbv-loading { display: inline-flex; align-items: center; gap: 8px; }\n      .pbv-loading-dot { width: 4px; height: 4px; border-radius: 50%; background: currentColor; animation: pbvPulse 1.4s ease-in-out infinite; }\n      .pbv-loading-dot:nth-child(2) { animation-delay: 0.2s; }\n      .pbv-loading-dot:nth-child(3) { animation-delay: 0.4s; }\n      @keyframes pbvPulse { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }\n      @media (max-width: 768px) { #pbv-tooltip { font-size: 16px !important; line-height: 1.7 !important; } .pbv-ref { padding: 2px 4px; margin: -2px -4px; } }\n      @media (hover: none) { .pbv-ref { -webkit-tap-highlight-color: transparent; touch-action: manipulation; } }\n    `}function createTooltip(){const t=document.createElement("div");t.id="pbv-tooltip",t.setAttribute("role","tooltip"),t.setAttribute("aria-live","polite"),t.setAttribute("tabindex","-1");const o=l[resolveThemeName()],r=n(),s=r?e.mobileMaxWidth:e.maxWidth;Object.assign(t.style,{position:"fixed",maxWidth:String(s)+"px",width:r?"calc(100vw - 32px)":"auto",background:o.solidBackground,backgroundImage:o.background,border:"1px solid "+o.border,borderRadius:r?"14px":"12px",boxShadow:r?o.mobileShadow:o.shadow,zIndex:2147483647,display:"none",fontFamily:"Inter, ui-sans-serif, system-ui, -apple-system, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif",fontSize:r?"16px":"14px",lineHeight:r?"1.75":"1.65",color:o.text,opacity:"0",transition:e.enableAnimations?"opacity 0.2s ease-out, transform 0.2s ease-out":"none",pointerEvents:"auto",contain:"layout style",overflowY:"auto",overflowX:"hidden",maxHeight:r?"60vh":"80vh",WebkitOverflowScrolling:"touch",backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxSizing:"border-box",overscrollBehavior:"contain",padding:r?"14px 16px":"12px 14px"});let a=0;t.addEventListener("touchstart",e=>{e.touches&&e.touches.length&&(a=e.touches[0].clientY)},{passive:!0}),t.addEventListener("touchmove",e=>{if(!e.touches||!e.touches.length)return;e.touches[0].clientY-a>50&&hideTooltip(!0)},{passive:!0}),t.addEventListener("mouseenter",()=>{g=!0,clearTimeout(p)}),t.addEventListener("mouseleave",e=>{g=!1;const t=e.relatedTarget;t&&t.closest&&t.closest(".pbv-ref")||hideTooltip(!1)});const updatePosition=()=>{"block"===t.style.display&&d&&requestAnimationFrame(()=>function repositionToPinnedAnchor(e){const t=e.getBoundingClientRect(),n=t.left+t.width/2,o=t.top;positionTooltipAt(n,o,e)}(d))};return t._updatePosition=updatePosition,window.addEventListener("scroll",updatePosition,{passive:!0}),window.addEventListener("resize",updatePosition,{passive:!0}),window.addEventListener("orientationchange",updatePosition),document.body.appendChild(t),t}function initTooltip(){c||(injectStyles(),c=createTooltip())}function positionTooltipAt(t,o,r){const s=n(),a=c.getBoundingClientRect(),i=r.getBoundingClientRect();if(s){const t=Math.max(16,Math.min(window.innerWidth-a.width-16,(window.innerWidth-a.width)/2));let n;const o=i.top,r=window.innerHeight-i.bottom;n="top"===e.position?i.top-a.height-10:"bottom"===e.position||r>a.height+20||r>o?i.bottom+10:i.top-a.height-10,c.style.left=String(t)+"px",c.style.top=String(Math.max(16,Math.min(n,window.innerHeight-a.height-16)))+"px"}else{let n=t+15,r=o+15;n+a.width>window.innerWidth-20&&(n=t-a.width-15),n<20&&(n=20),"top"===e.position?r=i.top-a.height-10:"bottom"===e.position?r=i.bottom+10:r+a.height>window.innerHeight-20&&(r=i.top-a.height-10),c.style.left=String(n)+"px",c.style.top=String(Math.max(20,r))+"px"}}function showTooltip(t,o,r,s){clearTimeout(p),initTooltip(),d=s,s.classList.add("pbv-active"),s.setAttribute("aria-expanded","true"),s.setAttribute("aria-controls","pbv-tooltip"),c.innerHTML="",c.appendChild(t),c.style.display="block",positionTooltipAt(o,r,s),requestAnimationFrame(()=>{c.style.opacity="1",e.enableAnimations&&!n()&&(c.style.transform="translateY(0)")}),e.analytics&&window.gtag&&window.gtag("event","verse_preview",{event_category:"engagement",event_label:s.dataset.ref})}function actuallyHideTooltip(){c&&(abortAllActiveRequests(),document.querySelectorAll(".pbv-active").forEach(e=>{e.classList.remove("pbv-active"),e.setAttribute("aria-expanded","false")}),c.style.opacity="0",e.enableAnimations&&!n()&&(c.style.transform="translateY(4px)"),setTimeout(()=>{c&&(c.style.display="none",d=null)},200))}function hideTooltip(t){clearTimeout(p),t?actuallyHideTooltip():p=setTimeout(()=>{g||y||actuallyHideTooltip()},e.hideDelayMs)}function buildChapterUrl(e,t){const n=new RegExp("^\\s*("+o+")\\.?\\s+(\\d+)(?::(\\d+))?","i"),r=String(e).match(n);if(!r)return"https://primebible.com/?ref=embed";const s=r[1].replace(/\./g,"").trim(),a=r[2],i=r[3],l=function bookNameToSlug(e){const t=String(e).trim().replace(/\s+/g," ");return{Genesis:"genesis",Exodus:"exodus",Leviticus:"leviticus",Numbers:"numbers",Deuteronomy:"deuteronomy",Joshua:"joshua",Judges:"judges",Ruth:"ruth","1 Samuel":"1-samuel","2 Samuel":"2-samuel","1 Kings":"1-kings","2 Kings":"2-kings","1 Chronicles":"1-chronicles","2 Chronicles":"2-chronicles",Ezra:"ezra",Nehemiah:"nehemiah",Esther:"esther",Job:"job",Psalms:"psalms",Psalm:"psalms",Proverbs:"proverbs",Ecclesiastes:"ecclesiastes","Song of Solomon":"song-of-solomon","Song of Songs":"song-of-solomon",Isaiah:"isaiah",Jeremiah:"jeremiah",Lamentations:"lamentations",Ezekiel:"ezekiel",Daniel:"daniel",Hosea:"hosea",Joel:"joel",Amos:"amos",Obadiah:"obadiah",Jonah:"jonah",Micah:"micah",Nahum:"nahum",Habakkuk:"habakkuk",Zephaniah:"zephaniah",Haggai:"haggai",Zechariah:"zechariah",Malachi:"malachi",Matthew:"matthew",Matt:"matthew",Mt:"matthew",Mat:"matthew",Mark:"mark",Luke:"luke",John:"john",Acts:"acts",Romans:"romans","1 Corinthians":"1-corinthians","2 Corinthians":"2-corinthians",Galatians:"galatians",Ephesians:"ephesians",Philippians:"philippians",Colossians:"colossians","1 Thessalonians":"1-thessalonians","2 Thessalonians":"2-thessalonians","1 Timothy":"1-timothy","2 Timothy":"2-timothy",Titus:"titus",Philemon:"philemon",Hebrews:"hebrews",James:"james","1 Peter":"1-peter","2 Peter":"2-peter","1 John":"1-john","2 John":"2-john","3 John":"3-john",Jude:"jude",Revelation:"revelation"}[t]||t.toLowerCase().replace(/\s+/g,"-")}(s);let c="https://primebible.com/"+String(t||"kjv").toLowerCase()+"/"+l+"/"+a;return i&&(c+="#verse-"+i),c+="?ref=embed",c}function createLoadingNode(e){const t=l[resolveThemeName()],n=document.createDocumentFragment(),o=document.createElement("div");o.style.cssText="padding: 20px; text-align: center; color: "+t.reference+";";const r=document.createElement("div");r.className="pbv-loading",r.style.cssText="display: inline-flex; align-items: center; gap: 8px; margin-bottom: 8px;";for(let e=0;e<3;e++){const e=document.createElement("span");e.className="pbv-loading-dot",r.appendChild(e)}o.appendChild(r);const s=document.createElement("div");return s.style.fontSize="13px",s.textContent="Loading "+e,o.appendChild(s),n.appendChild(o),n}function buildTooltipContent(t,o,r){const s=l[resolveThemeName()],a=n(),i=document.createDocumentFragment();if(e.showReference){const e=document.createElement("div");e.style.cssText=`\n        font-weight: 650;\n        margin-bottom: ${a?"16px":"12px"};\n        padding-bottom: ${a?"12px":"10px"};\n        border-bottom: 1px solid ${s.border};\n        color: ${s.reference};\n        font-size: ${a?"17px":"15px"};\n        letter-spacing: -0.01em;\n      `;const n=document.createElement("span");n.setAttribute("data-pbv-ref","1"),n.textContent=compressRefForDisplay(t),e.appendChild(n);const r=document.createElement("span");r.style.cssText=`\n        margin-left: 10px;\n        padding: 3px 7px;\n        background: ${s===l.dark?"rgba(255,255,255,0.10)":"rgba(0,0,0,0.06)"};\n        border-radius: 6px;\n        font-size: ${a?"13px":"12px"};\n        font-weight: 600;\n        opacity: 0.9;\n      `,r.textContent=o,e.appendChild(r),i.appendChild(e)}const c=document.createElement("div");c.style.cssText=`\n      padding: ${a?"0 16px 16px":"0 14px 12px"};\n      max-height: ${a?"42vh":"60vh"};\n      overflow-y: auto;\n      overflow-x: hidden;\n      -webkit-overflow-scrolling: touch;\n      scroll-behavior: smooth;\n      word-break: break-word;\n      overflow-wrap: anywhere;\n      white-space: normal;\n      width: 100%;\n      max-width: 100%;\n    `;if(r.forEach((e,t)=>{const n=document.createElement("div");n.style.cssText=`\n        margin-bottom: ${t<r.length-1?a?"12px":"10px":"0"};\n        line-height: ${a?"1.85":"1.75"};\n        overflow-wrap: anywhere;\n        word-break: break-word;\n      `;const o=function sanitizeApiHtml(e){try{const t=new Set(["STRONG","EM","B","I","BR","SPAN","SUP"]);let n=null;if("function"==typeof DOMParser){n=(new DOMParser).parseFromString(String(e||""),"text/html").body}else{const r=document.createElement("template");r.innerHTML=String(e||""),n=r.content}function cleanse(e){if(e.nodeType===Node.TEXT_NODE)return document.createTextNode(e.nodeValue||"");if(e.nodeType===Node.ELEMENT_NODE){const n=e.nodeName.toUpperCase();if(!t.has(n)){const t=document.createDocumentFragment();return e.childNodes.forEach(e=>t.appendChild(cleanse(e))),t}const o=document.createElement(n.toLowerCase());return"SPAN"===n&&"verse-num"===e.className&&(o.className="verse-num"),e.childNodes.forEach(e=>o.appendChild(cleanse(e))),o}return document.createTextNode("")}const o=document.createDocumentFragment();return(n.childNodes?Array.from(n.childNodes):[]).forEach(e=>o.appendChild(cleanse(e))),o}catch{return document.createTextNode(String(e||""))}}(e);n.appendChild(o),n.querySelectorAll(".verse-num, sup").forEach(e=>{e.style.cssText=`\n          color: ${s.verseNumber};\n          font-size: 0.85em;\n          font-weight: 600;\n          margin-right: 4px;\n          opacity: 0.7;\n        `}),c.appendChild(n)}),i.appendChild(c),e.showFooter){const e=document.createElement("div");e.style.cssText=`\n        margin: 0;\n        padding: ${a?"12px 16px 16px":"10px 14px 12px"};\n        background: ${s.footerBg};\n        border-top: 1px solid ${s.footerBorder};\n        border-radius: 0 0 ${a?"14px":"12px"} ${a?"14px":"12px"};\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n        font-size: ${a?"13px":"12px"};\n        color: ${s.footerText};\n      `;const n=document.createElement("a");n.href="https://primebible.com/?ref=embed",n.target="_blank",n.rel="noopener noreferrer nofollow",n.style.cssText=`\n        color: ${s.footerLink};\n        text-decoration: none;\n        font-weight: 600;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        transition: opacity 0.2s ease;\n      `,n.onmouseover=()=>n.style.opacity="0.85",n.onmouseout=()=>n.style.opacity="1";const r=document.createElement("span");r.innerHTML='<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path><line x1="12" y1="6" x2="12" y2="14"></line><line x1="8" y1="10" x2="16" y2="10"></line></svg>',n.appendChild(r);const l=document.createElement("span");l.textContent="Powered by PrimeBible",n.appendChild(l),e.appendChild(n);const c=document.createElement("a");c.href=buildChapterUrl(t,o),c.target="_blank",c.rel="noopener noreferrer",c.style.cssText=`\n        color: ${s.footerLink};\n        text-decoration: none;\n        font-weight: 600;\n        font-size: 12px;\n        opacity: 0.9;\n        transition: opacity 0.2s ease;\n      `,c.textContent="Read full chapter ->",c.setAttribute("aria-label","Read full chapter for "+t),c.onmouseover=()=>c.style.opacity="1",c.onmouseout=()=>c.style.opacity="0.9",e.appendChild(c),i.appendChild(e)}return i}async function fetchPassage(t,n){const o=normalizeRef(t),r=o+"::"+e.translation;if(E.has(r)&&!function isExpired(t){const n=N.get(t);return!n||Date.now()-n>e.cacheExpiry}(r)){return E.get(r)()}if(I.has(r))return I.get(r);const s=(async()=>{try{const t=expandPiecesWithVerseCounts(splitRefIntoPieces(o)),s=function pLimit(e){const t=[];let n=0;const next=()=>{n--,t.length&&t.shift()()};return o=>new Promise((r,s)=>{const run=()=>{n++,o().then(e=>{r(e),next()},e=>{s(e),next()})};n<e?run():t.push(run)})}(Math.max(1,e.maxConcurrentFetches||4)),a=await Promise.all(t.map(t=>s(()=>fetchSingleRef(t,e.translation,n)).catch(()=>"[Unable to load: "+t+"]"))),factory=()=>buildTooltipContent(o,e.translation,a);return E.set(r,factory),N.set(r,Date.now()),function manageCacheSize(){E.size>e.maxCacheSize&&Array.from(N.entries()).sort((e,t)=>e[1]-t[1]).slice(0,Math.floor(e.maxCacheSize/4)).forEach(([e])=>{E.delete(e),N.delete(e)})}(),factory()}catch(t){if("function"==typeof e.onError)try{e.onError(t,o)}catch{}const factory=()=>function buildErrorContent(t,n){const o=l[resolveThemeName()],r=document.createDocumentFragment(),s=document.createElement("div");s.style.cssText="padding: 20px; text-align: center;";const a=document.createElement("div");a.innerHTML='<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="'+o.text+'" stroke-width="1.5" opacity="0.3"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>',a.style.marginBottom="12px",s.appendChild(a);const i=document.createElement("div");i.style.cssText="color: "+o.text+"; font-size: 14px; margin-bottom: 8px; opacity: 0.7;",i.textContent="Unable to load "+t,s.appendChild(i);const d=document.createElement("button");return d.style.cssText="background: "+o.footerLink+"; color: white; border: none; padding: 8px 16px; border-radius: 6px; font-size: 13px; cursor: pointer; transition: opacity 0.2s ease;",d.textContent="Try Again",d.onclick=async()=>{const n=normalizeRef(t)+"::"+e.translation;E.delete(n),N.delete(n);const o=await fetchPassage(t);c.innerHTML="",c.appendChild(o)},d.onmouseover=()=>d.style.opacity="0.85",d.onmouseout=()=>d.style.opacity="1",s.appendChild(d),r.appendChild(s),r}(o);E.set(r,factory),N.set(r,Date.now());const n=setTimeout(()=>{E.delete(r),N.delete(r),k.delete(n)},6e4);return k.add(n),factory()}finally{I.delete(r)}})();return I.set(r,s),s}function prefetchNearbyRefs(t){if(!e.prefetch)return;const n=document.querySelectorAll(".pbv-ref"),o=Array.from(n).indexOf(t);[-1,1].forEach(e=>{const t=n[o+e];t&&t.dataset.refNormalized&&requestIdleCallback(()=>{fetchPassage(t.dataset.refNormalized).catch(()=>{})},{timeout:2e3})})}function makeInteractive(t){if("1"===t.dataset.pbvBound)return;t.dataset.pbvBound="1";const o=n(),r=l[resolveThemeName()];t.style.cssText=`\n      cursor: ${o?"pointer":"help"};\n      text-decoration: underline;\n      text-decoration-style: ${o?"solid":"dotted"};\n      text-decoration-color: ${r===l.dark?"rgba(147, 197, 253, 0.5)":"rgba(59, 130, 246, 0.4)"};\n      text-underline-offset: 3px;\n      text-decoration-thickness: ${o?"2px":"1px"};\n      transition: all 0.2s ease;\n      position: relative;\n      display: inline-block;\n    `,t.setAttribute("role","button"),t.setAttribute("tabindex","0"),t.setAttribute("aria-label","View "+t.dataset.ref),t.setAttribute("aria-expanded","false"),t.setAttribute("aria-controls","pbv-tooltip");let s=null,a=!1;hasTouch()||(t.addEventListener("mouseenter",n=>{y=!0,clearTimeout(p),t.style.textDecorationColor=r===l.dark?"rgba(147, 197, 253, 0.8)":"rgba(59, 130, 246, 0.7)",clearTimeout(h),h=setTimeout(async()=>{initTooltip();const e=T.get(t);if(e){try{e.abort()}catch{}C.delete(e)}const o=new AbortController;T.set(t,o),C.add(o);const r={};v.set(t,r);showTooltip(createLoadingNode(t.dataset.refNormalized||t.dataset.ref),n.clientX,n.clientY,t);try{const e=await fetchPassage(t.dataset.refNormalized||t.dataset.ref,o.signal);if(o.signal.aborted)return;if(v.get(t)!==r||d!==t)return;showTooltip(e,n.clientX,n.clientY,t);const s=c&&c.querySelector("[data-pbv-ref]");s&&(s.textContent=t.dataset.ref.trim()),prefetchNearbyRefs(t)}finally{C.delete(o)}},e.hoverDelayMs)}),t.addEventListener("mousemove",e=>{c&&"block"===c.style.display&&d===t&&positionTooltipAt(e.clientX,e.clientY,t)}),t.addEventListener("mouseleave",e=>{const n=e.relatedTarget;n&&n.closest&&(n.closest(".pbv-ref")||n.closest("#pbv-tooltip"))||(y=!1,hideTooltip(!1)),t.style.textDecorationColor=r===l.dark?"rgba(147, 197, 253, 0.5)":"rgba(59, 130, 246, 0.4)"})),hasTouch()&&(t.addEventListener("touchstart",n=>{u=Date.now(),m=n.touches[0].clientX,f=n.touches[0].clientY,a=!1,clearTimeout(s),s=setTimeout(()=>{a=!0,window.navigator&&window.navigator.vibrate&&window.navigator.vibrate(50),t.style.transform="scale(0.95)",setTimeout(()=>t.style.transform="",100)},e.longPressMs)},{passive:!0}),t.addEventListener("touchmove",e=>{const t=Math.abs(e.touches[0].clientX-m),n=Math.abs(e.touches[0].clientY-f);(t>10||n>10)&&(clearTimeout(s),a=!1)},{passive:!0}),t.addEventListener("touchend",async e=>{clearTimeout(s);const n=Date.now()-u;if(a||n<500){e.preventDefault(),initTooltip();const n=t.getBoundingClientRect();if(c&&d===t&&"block"===c.style.display)return void hideTooltip(!0);const o=T.get(t);if(o){try{o.abort()}catch{}C.delete(o)}const r=new AbortController;T.set(t,r),C.add(r);const s={};v.set(t,s);showTooltip(createLoadingNode(t.dataset.refNormalized||t.dataset.ref),n.left+n.width/2,n.top,t);try{const e=await fetchPassage(t.dataset.refNormalized||t.dataset.ref,r.signal);if(r.signal.aborted)return;if(v.get(t)!==s||d!==t)return;showTooltip(e,n.left+n.width/2,n.top,t);const o=c&&c.querySelector("[data-pbv-ref]");o&&(o.textContent=t.dataset.ref.trim()),prefetchNearbyRefs(t)}finally{C.delete(r)}}},{passive:!1})),t.addEventListener("keydown",async e=>{if("Enter"!==e.key&&" "!==e.key)return;e.preventDefault(),initTooltip();const n=t.getBoundingClientRect(),o=T.get(t);if(o){try{o.abort()}catch{}C.delete(o)}const r=new AbortController;T.set(t,r),C.add(r);const s={};v.set(t,s);showTooltip(createLoadingNode(t.dataset.refNormalized||t.dataset.ref),n.left+n.width/2,n.top,t);try{const e=await fetchPassage(t.dataset.refNormalized||t.dataset.ref,r.signal);if(r.signal.aborted)return;if(v.get(t)!==s||d!==t)return;showTooltip(e,n.left+n.width/2,n.top,t),c&&(c.focus(),function attachTooltipKbdHandler(e){if(!c)return;c._kbdHandler&&c.removeEventListener("keydown",c._kbdHandler);const handler=t=>{if("Escape"===t.key){try{e.focus({preventScroll:!0})}catch{}hideTooltip(!0)}};c._kbdHandler=handler,c.addEventListener("keydown",handler)}(t));const o=c&&c.querySelector("[data-pbv-ref]");o&&(o.textContent=t.dataset.ref.trim()),prefetchNearbyRefs(t)}finally{C.delete(r)}}),t.addEventListener("focus",()=>{t.style.outline="2px solid "+(l[resolveThemeName()]===l.dark?"#60a5fa":"#2563eb"),t.style.outlineOffset="2px",t.style.borderRadius="3px"}),t.addEventListener("blur",()=>{t.style.outline="none"})}function shouldProcessNode(t){if(!t.parentNode)return!1;const n=e.excludeSelectors.join(",");if(t.parentNode.closest&&t.parentNode.closest(n))return!1;if(t.parentNode.closest&&t.parentNode.closest(".pbv-ref, #pbv-tooltip"))return!1;const o=t.nodeValue||"";return!!i.test(o)&&!(o.length>e.maxNodeTextLength)}function processTextNode(t){const n=t.nodeValue||"";a.lastIndex=0;let o=!1;const r=document.createDocumentFragment();let s,i=0,l=0;for(;(s=a.exec(n))&&(l++,!(l>e.maxMatchesPerNode));){o=!0;const e=n.slice(i,s.index);e&&r.appendChild(document.createTextNode(e));const t=s[0],l=normalizeRef(t),c=document.createElement("span");c.className="pbv-ref",c.textContent=t,c.dataset.ref=t.trim(),c.dataset.refNormalized=l,makeInteractive(c),r.appendChild(c),i=a.lastIndex}if(o){const e=n.slice(i);e&&r.appendChild(document.createTextNode(e)),t.parentNode&&t.parentNode.replaceChild(r,t)}}function scanElement(e,t={}){const{immediate:n=!1}=t,walk=()=>{const t=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:e=>shouldProcessNode(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},!1),o=[];for(;t.nextNode();)o.push(t.currentNode);if(n)o.forEach(processTextNode);else{const e=10;let t=0;const step=()=>{o.slice(t,t+e).forEach(processTextNode),t+=e,t<o.length&&requestIdleCallback(step)};step()}};n?walk():requestIdleCallback(walk,{timeout:1e3})}function observeForLazyScan(e){if(!("IntersectionObserver"in window))return void scanElement(e.body?e.body:e,{immediate:!0});b||(b=new IntersectionObserver(e=>{e.forEach(e=>{const t=e.target;e.isIntersecting&&!t.dataset.pbvProcessed&&(scanElement(t,{immediate:!0}),t.dataset.pbvProcessed="true",b.unobserve(t),t.removeAttribute("data-pbvObserved"))})},{rootMargin:"100px"}));(e.body?e.body:e).querySelectorAll("article, section, main, aside, p, li, h1, h2, h3, h4, h5, h6, blockquote, div").forEach(e=>{e.dataset.pbvObserved||(e.dataset.pbvObserved="true",b.observe(e))})}let P=null;window.PrimeBible={VERSION:"2.5.2",scan:(e=document.body)=>{scanElement(e,{immediate:!0})},clearCache:()=>{E.clear(),N.clear(),I.clear()},config:t=>{let n=!1;return Object.prototype.hasOwnProperty.call(t,"translation")&&t.translation!==e.translation&&(n=!0),Object.prototype.hasOwnProperty.call(t,"chapterVerseCounts")&&(n=!0),Object.prototype.hasOwnProperty.call(t,"apiUrl")&&t.apiUrl!==e.apiUrl&&(n=!0),Object.prototype.hasOwnProperty.call(t,"maxConcurrentFetches")&&t.maxConcurrentFetches!==e.maxConcurrentFetches&&(n=!0),Object.assign(e,t),n&&(abortAllActiveRequests(),E.clear(),N.clear(),I.clear()),Object.prototype.hasOwnProperty.call(t,"theme")&&injectStyles(),e},destroy:()=>{abortAllActiveRequests(),P&&(P.disconnect(),P=null),w&&(w.disconnect(),w=null),b&&(b.disconnect(),b=null),k.forEach(clearTimeout),k.clear(),c&&(c._updatePosition&&(window.removeEventListener("scroll",c._updatePosition),window.removeEventListener("resize",c._updatePosition),window.removeEventListener("orientationchange",c._updatePosition)),c._kbdHandler&&(c.removeEventListener("keydown",c._kbdHandler),c._kbdHandler=null),c.remove(),c=null),window.__PBV_GLOBAL_BOUND__&&(document.removeEventListener("click",docClickHandler),document.removeEventListener("keydown",docKeydownHandler),window.__PBV_GLOBAL_BOUND__=!1);const e=document.getElementById("pbv-styles");e&&e.remove(),document.querySelectorAll(".pbv-ref").forEach(e=>{e.removeAttribute("data-pbv-bound");const t=document.createTextNode(e.textContent||"");e.parentNode&&e.parentNode.replaceChild(t,e)}),g=!1,y=!1,E.clear(),N.clear(),I.clear()},getStats:()=>({cacheSize:E.size,pendingRequests:I.size,referencesFound:document.querySelectorAll(".pbv-ref").length,theme:resolveThemeName(),isMobile:n(),tooltipOpen:!(!c||"block"!==c.style.display),hoverState:{overTooltip:g,overAnyRef:y}}),prefetchRef:e=>fetchPassage(e),setTranslation:t=>{t!==e.translation&&(e.translation=t,abortAllActiveRequests(),E.clear(),N.clear(),I.clear())},isSupported:()=>"undefined"!=typeof document&&"undefined"!=typeof window&&"addEventListener"in window&&"querySelector"in document,runTests:function runTests(){const t=[];function eq(n,o,r){const s=Array.isArray(r)?JSON.stringify(o)===JSON.stringify(r):o===r;t.push({name:n,ok:s,got:o,want:r}),s&&!e.debug||console.log(n,s?"OK":"FAIL",{got:o,want:r})}return eq("display John 3:16-4:2",compressRefForDisplay("John 3:16-4:2"),"John 3:16-4:2"),eq("display Genesis 1:31-2:3",compressRefForDisplay("Genesis 1:31-2:3"),"Genesis 1:31-2:3"),eq("display Mat. 5:3-12",compressRefForDisplay("Mat. 5:3-12"),"Mat 5:3-12"),eq("display 1 Cor. 13:1-13; 14:1",compressRefForDisplay("1 Cor. 13:1-13; 14:1"),"1 Cor 13:1-13; 14:1"),eq("split John 3:16-4:2",splitRefIntoPieces("John 3:16-4:2"),["John 3:16-4:2"]),eq("split Genesis 1:31-2:3",splitRefIntoPieces("Genesis 1:31-2:3"),["Genesis 1:31-2:3"]),eq("split 1 Cor. 13:1-13; 14:1",splitRefIntoPieces("1 Cor. 13:1-13; 14:1"),["1 Cor 13:1-13","1 Cor 14:1"]),eq("expand no-counts John 3:16-4:2",expandPiecesWithVerseCounts(["John 3:16-4:2"]),["John 3:16-999","John 4:1-2"]),eq("expand no-counts Genesis 1:31-2:3",expandPiecesWithVerseCounts(["Genesis 1:31-2:3"]),["Genesis 1:31-999","Genesis 2:1-3"]),eq("expand no-counts John 3-4",expandPiecesWithVerseCounts(["John 3-4"]),["John 3:1-999","John 4:1-999"]),{ok:t.every(e=>e.ok),results:t}}},window.PrimeBible.isSupported()?function init(){injectStyles();const initScan=()=>{e.lazyScan?observeForLazyScan(document):scanElement(document.body,{immediate:!0})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initScan,{once:!0}):initScan();let t=null;const o=new Set,processMutations=()=>{o.forEach(t=>{t&&(b&&e.lazyScan&&t.nodeType===Node.ELEMENT_NODE?observeForLazyScan(t):t.nodeType===Node.TEXT_NODE?shouldProcessNode(t)&&t.parentNode&&scanElement(t.parentNode,{immediate:!1}):t.nodeType===Node.ELEMENT_NODE&&scanElement(t,{immediate:!1}))}),o.clear()};if(P=new MutationObserver(e=>{for(const t of e)"characterData"===t.type&&o.add(t.target),t.addedNodes&&t.addedNodes.forEach(e=>o.add(e));clearTimeout(t),t=setTimeout(processMutations,100)}),x=document.body,P.observe(x,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),w=new MutationObserver(()=>{document.body&&document.body!==x&&(P&&P.disconnect(),x=document.body,P&&P.observe(x,{childList:!0,subtree:!0,characterData:!0,attributes:!1}),e.lazyScan?observeForLazyScan(document):scanElement(x,{immediate:!0}))}),w.observe(document.documentElement,{childList:!0,subtree:!0}),window.matchMedia){const t=window.matchMedia("(prefers-color-scheme: dark)"),onChange=()=>{if("system"===e.theme){if(injectStyles(),c){const e=l[resolveThemeName()];c.style.background=e.solidBackground,c.style.backgroundImage=e.background,c.style.color=e.text,c.style.borderColor=e.border,c.style.boxShadow=n()?e.mobileShadow:e.shadow}E.clear(),N.clear()}};t.addEventListener?t.addEventListener("change",onChange):t.addListener&&t.addListener(onChange)}}():console.warn("PrimeBible: Browser not supported"),"undefined"!=typeof module&&module.exports&&("undefined"!=typeof window&&window.PrimeBible?module.exports=window.PrimeBible:module.exports={})}();
